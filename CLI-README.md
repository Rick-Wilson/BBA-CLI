# BBA-CLI - Bridge Bidding Analyzer Command Line Interface

BBA-CLI generates bridge auctions for deals in PBN (Portable Bridge Notation) files using the EPBot bidding engine.

## Installation

Download the latest release from [GitHub Releases](https://github.com/rick-wilson/BBA-CLI/releases). The release package includes:

- `bba-cli.exe` - Main CLI executable (C# implementation, recommended)
- `bba-cli-rust.exe` - Alternative Rust CLI implementation
- `epbot-wrapper.exe` - EPBot wrapper (used by Rust CLI)
- `EPBot64.dll` - EPBot bidding engine
- Supporting DLLs and config files

Extract all files to the same directory.

## Requirements

- Windows x64
- .NET Framework 4.8 (usually pre-installed on Windows 10/11)

## Usage

```
bba-cli --input <INPUT.pbn> --output <OUTPUT.pbn> --ns-conventions <NS.bbsa> --ew-conventions <EW.bbsa> [OPTIONS]
```

### Required Arguments

| Argument | Short | Description |
|----------|-------|-------------|
| `--input <FILE>` | `-i` | Input PBN file containing deals to analyze |
| `--output <FILE>` | `-o` | Output PBN file for results with generated auctions |
| `--ns-conventions <FILE>` | | Convention card file (.bbsa) for North-South partnership |
| `--ew-conventions <FILE>` | | Convention card file (.bbsa) for East-West partnership |

### Optional Arguments

| Argument | Short | Description |
|----------|-------|-------------|
| `--scoring <TYPE>` | | Scoring type for output (default: `MP`) |
| `--verbose` | `-v` | Enable verbose logging |
| `--dry-run` | | Parse input but don't write output |
| `--help` | `-h` | Show help message |
| `--version` | | Show version number |

### Scoring Types

Common values for `--scoring`:
- `MP` - Matchpoints (default)
- `IMP` - International Match Points
- `BAM` - Board-a-Match
- `Cavendish` - Cavendish scoring
- `Chicago` - Chicago/Party bridge scoring
- `Rubber` - Rubber bridge scoring

## Convention Files

Convention files use the `.bbsa` format from the BBA (Bridge Bidding Analyzer) application. These files define the bidding system conventions for each partnership.

Common convention files:
- `21GF-DEFAULT.bbsa` - 2/1 Game Force system
- `SAYC.bbsa` - Standard American Yellow Card
- `Precision.bbsa` - Precision Club system

## Example

```bash
bba-cli.exe -i deals.pbn -o auctions.pbn --ns-conventions 21GF-DEFAULT.bbsa --ew-conventions 21GF-DEFAULT.bbsa
```

With verbose output and IMP scoring:
```bash
bba-cli.exe -i deals.pbn -o auctions.pbn --ns-conventions 21GF-DEFAULT.bbsa --ew-conventions SAYC.bbsa --scoring IMP -v
```

## Input Format

The input file should be a valid PBN file with deal information. At minimum, each game record needs:
- `[Deal]` tag with the hand distribution

Example input:
```
[Event "Practice"]
[Board "1"]
[Dealer "S"]
[Vulnerable "None"]
[Deal "S:AKQ5.KQ7.A95.K87 T98.T652.Q84.T94 J43.AJ8.KJT2.A65 762.943.763.QJ32"]
```

## Output Format

BBA-CLI generates PBN 2.1 compliant output files with the following additions:

### Header Comments

The output includes informational header comments:
```
% PBN 2.1
% Generated by BBA-CLI v0.3.0
% https://github.com/rick-wilson/BBA-CLI
% The source file name: "C:\path\to\input.pbn"
% CC1 - 21GF-DEFAULT.bbsa
% CC2 - SAYC.bbsa
% 1-2 - Stayman
% 1-2 - Jacoby Transfers
% CC1 - 2/1 Game Force
% CC2 - Limit Raises
```

Convention annotations:
- `1-2` - Convention enabled for both partnerships
- `CC1` - Convention enabled only for North-South
- `CC2` - Convention enabled only for East-West

### Generated Tags

For each game record, BBA-CLI adds or updates:

| Tag | Description |
|-----|-------------|
| `[North]`, `[East]`, `[South]`, `[West]` | Player names (set to "EPBot") |
| `[Room "Open"]` | Room designation |
| `[Scoring]` | Scoring type (from `--scoring` option) |
| `[Auction]` | Generated bidding sequence |
| `[Contract]` | Final contract (e.g., "3N", "4SX") |
| `[Declarer]` | Declarer position (N/E/S/W) |
| `[Play]` | Play section placeholder with opening leader |
| `[BidSystemNS]` | NS bidding system name |
| `[BidSystemEW]` | EW bidding system name |

### Alerts and Announcements

Alertable bids are marked with `=N=` notation and explained in `[Note]` tags:

```
[Auction "S"]
1N Pass 2C =1= Pass
2D =2= Pass 3N Pass
Pass Pass
[Note "1:Stayman"]
[Note "2:No 4-card major"]
```

### Example Output

```
% PBN 2.1
% Generated by BBA-CLI v0.3.0
% https://github.com/rick-wilson/BBA-CLI

[Event "Practice"]
{089EE7B2A94C1D635F}
[Board "1"]
[North "EPBot"]
[East "EPBot"]
[South "EPBot"]
[West "EPBot"]
[Room "Open"]
[Dealer "S"]
[Vulnerable "None"]
[Deal "S:AKQ5.KQ7.A95.K87 T98.T652.Q84.T94 J43.AJ8.KJT2.A65 762.943.763.QJ32"]
{Shape: 4432-4432-4432-4432}
{HCP: 20-3-14-3}
{Losers: 4-10-5-10}
[Contract "6N"]
[Declarer "S"]
[Result ""]
[Scoring "MP"]
[Auction "S"]
2N =1= Pass 4N =2= Pass
6N Pass Pass Pass
[Note "1:20-21 HCP balanced"]
[Note "2:Quantitative invite to 6NT"]
[Play "W"]
*
[BidSystemEW "2/1GF - 2/1 Game Force"]
[BidSystemNS "2/1GF - 2/1 Game Force"]
```

## Exit Codes

| Code | Description |
|------|-------------|
| 0 | Success |
| 1 | Error (missing arguments, file not found, processing errors) |

## Related Projects

- [BBA](https://github.com/EdwardPiwowar/BBA) - Bridge Bidding Analyzer GUI application (source of EPBot64.dll)
- [Practice-Bidding-Scenarios](https://github.com/rick-wilson/Practice-Bidding-Scenarios) - Practice bidding scenarios generator

## License

This project wraps the EPBot bidding engine. See the [BBA repository](https://github.com/EdwardPiwowar/BBA) for EPBot licensing information.
